import{j as r,a as y,t as p,u as R,G as S,T as D,B as _,b as F,I as A}from"./index-2c6c3952.js";import{r as o,y as k,h as O}from"./vendor-c425c987.js";const C=l=>{const{className:c,items:t}=l,s=o.useRef(null),u=t==null?void 0:t.map(e=>e.x),f=t==null?void 0:t.map(e=>e.y),i=o.useRef(!1),n=o.useRef();return o.useEffect(()=>{if(!s.current||i.current)return;n.current=k(s.current),i.current=!0;const e={tooltip:{trigger:"axis",show:!0,formatter:([{axisValue:a,data:g}])=>{const h=a.split("-"),x=`${h[0]}年${h[1]}月${h[2]}日`,b=g===null?"无数据":`${g}元`;return`${x}<br/><div style="text-align: right;">${b}</div>`}},grid:{left:16,top:8,bottom:24,right:16},xAxis:{type:"category",data:u,axisLabel:{formatter:a=>a.slice(a.indexOf("-")+1)}},yAxis:{type:"value",axisLabel:{show:!1}},series:[{data:f,type:"line",itemStyle:{},emphasis:{itemStyle:{color:"green"}}}]};n.current.setOption(e)},[]),o.useEffect(()=>{var a;const e={xAxis:{data:u},series:[{data:f}]};(a=n.current)==null||a.setOption(e)},[t]),r("div",{ref:s,className:c})},E=l=>{const c=o.useRef(),{className:t,items:s=[]}=l,u=o.useRef(null),f=o.useRef(!1);return o.useEffect(()=>{if(!u.current||f.current)return;c.current=k(u.current),f.current=!0;const i={tooltip:{trigger:"item",formatter:({data:{name:n,value:e,sign:a}})=>`${a} ${n}: ${e}元`},grid:{top:50,left:0,bottom:0,right:0},legend:{orient:"horizontal",left:"left",itemWidth:20,itemHeight:10},series:[{name:"Access From",type:"pie",center:["50%","55%"],radius:"70%",data:s.map((n,e)=>({...n,value:parseFloat(n.value.toString())})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};c.current.setOption(i)},[]),o.useEffect(()=>{var n;const i={series:[{data:s}]};(n=c.current)==null||n.setOption(i)},[s]),r("div",{className:t,ref:u,children:" "})},N=l=>{const{className:c,items:t}=l,s=o.useRef(null),u=(t==null?void 0:t.reduce((e,a)=>e+parseFloat(a.value.toString()),0))??0,f=(t==null?void 0:t.reduce((e,a)=>Math.max(e,parseFloat(a.value.toString())),0))??0,i=["#5470c6","#ffbab0","#ffa750","#8748d3","#53a867","#eba953","#91cc75","#fac858","#ee6666","#73c0de"],n=()=>r("div",{children:t==null?void 0:t.map((e,a)=>y("div",{"b-1":"","b-solid":"","b-red":"",grid:"","grid-cols":"[48px_1fr_1fr]","text-14px":"","grid-rows":"[repeat,1fr)]","items-center":"","my-16px":"","px-16px":"","gap-x-8px":"","gap-y-6px":"",children:[r("div",{"row-start-1":"","col-start-1":"","row-end-3":"","col-end-2":"",bg:"#eee","w-48px":"","h-48px":"","rounded-24px":"",flex:"","items-center":"","justify-center":"","text-24px":"",children:e.sign}),y("div",{"row-start-1":"","col-start-2":"","row-end-2":"","col-end-3":"","self-end":"",children:[e.name,"-",`${(parseFloat(e.value.toString())/u*100).toFixed(0)}%`]}),y("div",{"row-start-1":"","col-start-3":"","row-end-2":"","col-end-4":"","text-right":"","self-end":"",children:[e.value," 元"]}),r("div",{"row-start-2":"","col-start-2":"","row-end-3":"","col-end-4":"","self-start":"","h-8px":"","rounded-4px":"",bg:"#eee",relative:"","overflow-hidden":"",children:r("div",{absolute:"","rounded-4px":"",h:"100%",style:{background:i[a],width:`${parseFloat(e.value.toString())/f*100}%`}})})]},e.name))});return r("div",{ref:s,className:c,children:t!=null&&t[0]?n():r("div",{"text-center":"",color:"[var(--color-pink)]",children:"暂无数据"})})},$=({start:l,end:c,kind:t,group_by:s})=>`/api/v1/items/summary?happened_after=${l.format("yyyy-MM-dd")}&happened_before=${c.format("yyyy-MM-dd")}&kind=${t}&group_by=${s}`,z=()=>{const[l,c]=o.useState({name:"thisMonth",start:p().firstDayOfMonth,end:p().lastDayOfMonth.add(1,"day")}),{get:t}=R({showLoading:!1,handleError:!0}),[s,u]=o.useState("expenses"),f=d=>Array.from({length:i.dayCountOfMonth}).map((v,m)=>({x:i.clone.add(m,"day").format("yyyy-MM-dd"),y:0})),{start:i,end:n}=l,e=f(),{data:a}=O($({start:i,end:n,kind:s,group_by:"happen_at"}),async d=>(await t(d)).data.groups.map(({happen_at:m,amount:M})=>({x:m,y:(M/100).toFixed(2)}))),g=e==null?void 0:e.map(d=>{const v=a==null?void 0:a.find(m=>m.x===d.x);return v||d});o.useEffect(()=>{},[a]);const{data:h}=O($({start:i,end:n,kind:s,group_by:"tag_id"}),async d=>(await t(d)).data),{groups:x,total:b}=h??{},w=x==null?void 0:x.map(d=>({name:d.tag.name,value:(d.amount/100).toFixed(2),sign:d.tag.sign}));return y("div",{children:[r(S,{children:r(D,{title:"统计图表",icon:r(_,{})})}),r(F,{selected:l,onSelect:c,timeRanges:[{text:"本月",key:{name:"thisMonth",start:p().firstDayOfMonth,end:p().lastDayOfMonth.add(1,"day")}},{text:"上月",key:{name:"lastMonth",start:p().add(-1,"month").firstDayOfMonth,end:p().add(-1,"month").lastDayOfMonth.add(1,"day")}},{text:"两个月前",key:{name:"twoMonthsAgo",start:p().add(-2,"month").firstDayOfMonth,end:p().add(-2,"month").lastDayOfMonth.add(1,"day")}},{text:"三个月前",key:{name:"threeMonthsAgo",start:p().add(-3,"month").firstDayOfMonth,end:p().add(-3,"month").lastDayOfMonth.add(1,"day")}}]}),y("div",{flex:"","px-16px":"","grow-0":"","shrink-0":"","items-center":"","gap-x-16px":"","p-16px":"",children:[r("span",{children:"类型"}),r("div",{"grow-1":"","shrink-1":"",children:r(A,{type:"select",options:[{text:"支出",value:"expenses"},{text:"收入",value:"income"}],value:s,onChange:d=>u(d),disableError:!0})})]}),r(C,{className:"h-200px  m-b-24px",items:g}),r(E,{className:"h-360px ",items:w}),r(N,{className:"h-300px",items:w})]})};export{z as default};
